# مستند معماری سیستم (Architecture Document)

عنوان پروژه: سامانه هوشمند مدیریت درمانگاه با نوبت‌دهی آنلاین، ویزیت مجازی و نظارت نسخه‌ها

تاریخ نگارش: 26 جولای 2025 (5 مرداد 1404)

نسخه: 1.0

تهیه‌کنندگان:
* امیرحسین عطائی (مسئول توسعه بک‌اند و زیرساخت)
* نگین یونسی (مسئول توسعه فرانت‌اند و طراحی UI/UX)

---

## ۱. مقدمه

### ۱.۱. هدف مستند

هدف از این مستند، تشریح جامع معماری نرم‌افزاری سامانه هوشمند مدیریت درمانگاه است. این سند به عنوان یک نقشه راه فنی عمل می‌کند و ساختار کلی سیستم، لایه‌های مختلف آن، ماژول‌های اصلی و نحوه تعامل آن‌ها با یکدیگر را توضیح می‌دهد. این معماری به گونه‌ای طراحی شده است که نیازمندی‌های عملکردی و غیرعملکردی ذکر شده در SRS را برآورده کرده و قابلیت توسعه‌پذیری، نگهداری و امنیت سیستم را تضمین کند.

### ۱.۲. دیدگاه معماری

سیستم با رویکرد Microservices-Oriented Architecture در ذهن طراحی شده است، اما در فاز اولیه به صورت یک Monolithic Application با ساختار ماژولار (Modular Monolith) پیاده‌سازی می‌شود. این رویکرد امکان توسعه سریع در فاز ابتدایی را فراهم می‌آورد، در حالی که مسیر روشنی برای تفکیک آینده به میکروسرویس‌های مستقل (در صورت نیاز به مقیاس‌پذیری بیشتر و تیم‌های بزرگ‌تر) ارائه می‌دهد.

### ۱.۳. اصطلاحات و تعاریف

* Monolithic Application: یک برنامه نرم‌افزاری که تمام اجزای آن (UI، منطق تجاری، دسترسی به داده) در یک واحد کد بزرگ قرار دارند.
* Modular Monolith: یک Monolith که به صورت داخلی به ماژول‌های جداگانه با مسئولیت‌های مشخص تقسیم شده است.
* Microservices: رویکردی معماری که در آن برنامه به مجموعه‌ای از سرویس‌های کوچک و مستقل با منطق تجاری خاص تقسیم می‌شود.
* MVC (Model-View-Controller): الگوی طراحی برای سازماندهی کد که وظایف نمایش داده (View)، مدیریت منطق (Controller) و نگهداری داده (Model) را از هم جدا می‌کند. در این پروژه، این الگو بیشتر در لایه بک‌اند اعمال می‌شود.
* API Gateway: نقطه‌ی ورود واحد برای درخواست‌های کلاینت به میکروسرویس‌ها (در صورت مهاجرت به میکروسرویس).
* RESTful API: رابط برنامه‌نویسی برای ارتباط بین سرویس‌ها بر اساس اصول REST.
* WebSockets: پروتکلی برای ارتباط دوطرفه و بلادرنگ.
* WebRTC: فناوری برای ارتباطات صوتی، تصویری و داده‌ای بلادرنگ مرورگر-به-مرورگر.

---

## ۲. معماری کلی سیستم (High-Level Architecture)

سیستم از سه لایه اصلی تشکیل شده که هر کدام مسئولیت‌های مشخصی دارند:

[Image: High-Level System Architecture Diagram]
(توضیح: یک نمودار ساده که لایه‌های زیر را نشان می‌دهد و ارتباط بین آن‌ها را با فلش‌ها مشخص می‌کند.)

* Presentation Layer (Client-Side / Frontend):
    * مسئولیت: تعامل با کاربر، نمایش رابط کاربری، جمع‌آوری ورودی‌های کاربر و ارسال درخواست‌ها به لایه Application.
    * تکنولوژی‌ها: React.js, Tailwind CSS/Bootstrap.

* Application/Business Logic Layer (Server-Side / Backend):
    * مسئولیت: حاوی منطق اصلی کسب‌وکار، پردازش درخواست‌ها، مدیریت احراز هویت و مجوزدهی، و هماهنگی با لایه Data Access.
    * تکنولوژی‌ها: Node.js, Express.js.

* Data Access Layer:
    * مسئولیت: واسطه‌ای بین لایه Business Logic و Database. مسئول انجام عملیات CRUD و مدیریت تراکنش‌ها.
    * تکنولوژی‌ها: Mongoose (ODM for MongoDB).

* Database Layer:
    * مسئولیت: ذخیره‌سازی و بازیابی پایدار داده‌های برنامه.
    * تکنولوژی‌ها: MongoDB.

* Real-time Communication Layer:
    * مسئولیت: فراهم آوردن ارتباطات بلادرنگ برای قابلیت‌هایی مانند چت و ویزیت مجازی.
    * تکنولوژی‌ها: WebSockets (Socket.IO), WebRTC.

---

## ۳. معماری جزئی بک‌اند (Backend Detailed Architecture - MVC with Services)

بک‌اند پروژه بر پایه الگوی MVC (Model-View-Controller) با افزودن یک لایه Service برای جداسازی منطق‌های پیچیده‌تر، سازماندهی شده است.

[Image: Backend Detailed Architecture Diagram (MVC with Services)]
(توضیح: یک نمودار که فلو درخواست را از Router به Controller به Service به Model و Database نشان می‌دهد.)

* Routes (مسیرها):
    * مسئولیت: تعریف API Endpoints و هدایت درخواست‌های HTTP به کنترلرهای مربوطه.
    * فایل‌ها: در فولدر `src/routes/` (مثلاً `authRoutes.js`, `userRoutes.js`).

* Controllers (کنترلرها):
    * مسئولیت: دریافت درخواست از Routes، اعتبارسنجی اولیه ورودی‌ها، فراخوانی منطق کسب‌وکار از لایه Services (یا مستقیماً Model برای عملیات ساده CRUD)، و ارسال پاسخ HTTP.
    * فایل‌ها: در فولدر `src/controllers/` (مثلاً `authController.js`, `userController.js`).

* Services (سرویس‌ها):
    * مسئولیت: کپسوله‌سازی منطق‌های پیچیده‌تر کسب‌وکار، هماهنگی بین چندین مدل، و ارتباط با سرویس‌های خارجی (مانند سرویس پیامک). این لایه به کنترلرها کمک می‌کند تا "سبک" بمانند.
    * فایل‌ها: در فولدر `src/services/` (مثلاً `authService.js`, `appointmentService.js`).

* Models (مدل‌ها):
    * مسئولیت: تعریف شمای داده (با Mongoose)، تعامل مستقیم با پایگاه داده (MongoDB)، و پیاده‌سازی منطق‌های مربوط به داده (مثلاً اعتبارسنجی در سطح شمای Mongoose، متدهای کمکی برای مدل).
    * فایل‌ها: در فولدر `src/models/` (مثلاً `User.js`, `Patient.js`, `Appointment.js`).

* Middleware (میان‌افزارها):
    * مسئولیت: توابعی که قبل از رسیدن درخواست به کنترلرها یا بعد از آن‌ها اجرا می‌شوند. شامل احراز هویت، مجوزدهی، مدیریت خطا، لاگ‌برداری و پردازش درخواست.
    * فایل‌ها: در فولدر `src/middleware/` (مثلاً `authMiddleware.js`, `errorHandler.js`).

* Utils (ابزارها):
    * مسئولیت: توابع کمکی عمومی که در بخش‌های مختلف برنامه استفاده می‌شوند و به منطق خاصی گره نخورده‌اند (مثلاً توابع اعتبارسنجی، مدیریت خطا).
    * فایل‌ها: در فولدر `src/utils/` (مثلاً `AppError.js`, `catchAsync.js`).

* Config (تنظیمات):
    * مسئولیت: مدیریت پیکربندی‌های مختلف برنامه مانند اتصال به دیتابیس، کلیدهای امنیتی، پورت‌ها و متغیرهای محیطی.
    * فایل‌ها: در فولدر `src/config/` (مثلاً `db.js`, `jwt.js`, `appConfig.js`).

---

## ۴. معماری فرانت‌اند (Frontend Architecture)

فرانت‌اند سیستم با React.js پیاده‌سازی می‌شود و از یک رویکرد Component-Based Architecture پیروی می‌کند.

[Image: Frontend Component-Based Architecture Diagram]
(توضیح: یک نمودار که صفحات اصلی، کامپوننت‌های عمومی، و سرویس‌های API را نشان می‌دهد.)

* Pages (صفحات):
    * مسئولیت: کامپوننت‌های سطح بالا که نماینده یک صفحه کامل در برنامه هستند و چندین کامپوننت کوچکتر را با هم ترکیب می‌کنند.
    * فایل‌ها: در فولدر `frontend/src/pages/` (مثلاً `LoginPage.js`, `AdminDashboard.js`).

* Components (کامپوننت‌ها):
    * مسئولیت: واحدهای کوچک، مستقل و قابل استفاده مجدد از رابط کاربری. به دسته‌هایی مانند UI (دکمه‌ها، ورودی‌ها)، Layout (هدر، فوتر، سایدبار) و Common (اسپینر، پیام خطا) تقسیم می‌شوند.
    * فایل‌ها: در فولدر `frontend/src/components/` (مثلاً `Button.js`, `Navbar.js`).

* Contexts / State Management (مدیریت وضعیت):
    * مسئولیت: مدیریت وضعیت‌های سراسری برنامه (مثلاً اطلاعات کاربر وارد شده، وضعیت احراز هویت) برای دسترسی آسان از هر کامپوننت.
    * تکنولوژی‌ها: React Context API (یا در آینده Redux/Zustand).
    * فایل‌ها: در فولدر `frontend/src/contexts/`.

* API Services (سرویس‌های API):
    * مسئولیت: کپسوله‌سازی منطق فراخوانی APIهای بک‌اند. این لایه مسئول ساخت درخواست‌های HTTP و پردازش پاسخ‌هاست.
    * تکنولوژی‌ها: Axios/Fetch.
    * فایل‌ها: در فولدر `frontend/src/api/` (مثلاً `authApi.js`, `appointmentApi.js`).

* Hooks (هوک‌ها):
    * مسئولیت: کپسوله‌سازی منطق‌های Reusable در کامپوننت‌های تابعی React (مثلاً منطق احراز هویت، اعتبارسنجی فرم).
    * فایل‌ها: در فولدر `frontend/src/hooks/`.

* Styles (استایل‌ها):
    * مسئولیت: مدیریت استایل‌های بصری برنامه.
    * تکنولوژی‌ها: Tailwind CSS (با فایل‌های CSS اصلی در `frontend/src/styles/`).

---

## ۵. تعامل بین لایه‌ها و ماژول‌ها

* Frontend ↔ Backend (RESTful API):
    * فرانت‌اند درخواست‌ها را از طریق API Services به Endpointsهای بک‌اند ارسال می‌کند. بک‌اند پاسخ‌های JSON را برمی‌گرداند.
    * برای احراز هویت، JWT در هدر `Authorization` ارسال می‌شود.
* Backend ↔ Database:
    * لایه Models (Mongoose) مسئول تعامل مستقیم با MongoDB است. سرویس‌ها و کنترلرها از Models برای ذخیره و بازیابی داده‌ها استفاده می‌کنند.
* Real-time Communication (WebSocket/WebRTC):
    * این ارتباطات موازی با RESTful API عمل می‌کنند. بک‌اند دارای یک سرور WebSocket (Socket.IO) است که فرانت‌اند برای چت و سیگنالینگ WebRTC به آن متصل می‌شود.

---

## ۶. ملاحظات امنیتی در معماری

* تفکیک لایه‌ها: جداسازی فرانت‌اند و بک‌اند، به افزایش امنیت با کاهش سطح حمله کمک می‌کند.
* API Gateway (در آینده): در صورت تفکیک به میکروسرویس‌ها، یک API Gateway می‌تواند وظیفه احراز هویت مرکزی، Rate Limiting و لاگ‌برداری را بر عهده بگیرد.
* HTTPS: تمامی ارتباطات باید از طریق HTTPS رمزنگاری شوند.
* اعتبارسنجی دوطرفه: اعتبارسنجی ورودی‌ها هم در فرانت‌اند و هم به صورت حیاتی در بک‌اند انجام می‌شود.
* مدیریت سشن: استفاده از JWT با زمان انقضای مناسب و مکانیزم Refresh Token.
* RBAC (Role-Based Access Control): پیاده‌سازی دقیق مجوزدهی در لایه بک‌اند برای اطمینان از دسترسی هر کاربر فقط به منابع مجاز.

---

## ۷. گسترش‌پذیری و تکامل آینده

معماری فعلی به گونه‌ای طراحی شده است که در آینده به راحتی قابل گسترش باشد:

* افزودن ماژول‌های جدید: با اضافه شدن بخش‌هایی مانند پرداخت آنلاین، سیستم بیمه، یا هوش مصنوعی، می‌توان ماژول‌های Service و Controller جدیدی را به بک‌اند افزود.
* مهاجرت به میکروسرویس‌ها: هر یک از فولدرهای `controllers/`, `models/`, `routes/`, `services/` می‌تواند در آینده به یک میکروسرویس مستقل (مثلاً `Auth Service`, `Appointment Service`) تبدیل شود.
* تغییرات در فرانت‌اند: معماری کامپوننت‌محور React.js امکان افزودن قابلیت‌های UI جدید و تغییرات طراحی را بدون تأثیر بر کل سیستم فراهم می‌کند.

---